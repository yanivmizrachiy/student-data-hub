<!doctype html>
<html lang="he" dir="rtl">
<head>
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#1e3a8a">
  <link rel="icon" sizes="192x192" href="./assets/icons/icon-192.png">
  <link rel="apple-touch-icon" sizes="512x512" href="./assets/icons/icon-512.png">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ניהול תלמידים — חטיבת ביניים</title>

  <!-- פונט עברי נקי -->
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;600;800&display=swap" rel="stylesheet" />

  <!-- עיצוב מותאם -->
  <link rel="stylesheet" href="styles.css" />

  <!-- צבע לדפדפנים ניידים -->
  <meta name="theme-color" content="#0e1f40" />

  <script>
    // Redirect to GitHub Pages if running on localhost
    if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
      location.replace('https://yanivmizrachiy.github.io/student-data-hub/');
    }
  </script>
</head>
<body>
  <div class="bg">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="blob b3"></div>
  </div>

  <header class="topbar container">
    <div class="brand">
      <span class="logo">📚</span>
      <span class="brand-title">ניהול תלמידים</span>
    </div>
    <div class="admin">
      <small class="muted" style="font-size:1.1rem;font-weight:700;">האתר מנוהל ע"י יניב רז</small>
    </div>
  </header>

  <main class="hero container">
    <h1 class="hero-title" style="margin-bottom:18px;">ניהול תלמידים</h1>
    <p class="hero-subtitle" style="font-size:1.1em;color:#b9c1e6;margin-bottom:32px;">האתר מנוהל ע"י יניב רז</p>
    <section class="grid">
      <a class="grade-card" style="min-height:220px;" href="pages/grade7.html" aria-label="שכבת ז'">
        <div class="badge">ז׳</div>
        <h2 style="font-size:2.2rem;">שכבת ז׳</h2>
        <div class="cta" style="background:linear-gradient(90deg,#4ea1ff,#2679ff);font-size:1.2rem;">כניסה</div>
      </a>
      <a class="grade-card" style="min-height:220px;" href="pages/grade8.html" aria-label="שכבת ח'">
        <div class="badge green">ח׳</div>
        <h2 style="font-size:2.2rem;">שכבת ח׳</h2>
        <div class="cta" style="background:linear-gradient(90deg,#43e97b,#ffd200);font-size:1.2rem;">כניסה</div>
      </a>
      <a class="grade-card" style="min-height:220px;" href="pages/grade9.html" aria-label="שכבת ט'">
        <div class="badge orange">ט׳</div>
        <h2 style="font-size:2.2rem;">שכבת ט׳</h2>
        <div class="cta" style="background:linear-gradient(90deg,#ffd200,#ff4e50);font-size:1.2rem;">כניסה</div>
      </a>
    </section>
    <div id="install-block" class="install">
      <button id="installBtn" class="btn install-btn" aria-label="התקן במחשב">התקן במחשב</button>
      <p id="iosHint" class="ios-hint" hidden>ב-iPhone/iPad: פתח ב-Safari → שתף → הוסף למסך הבית</p>
    </div>
  </main>


    <!-- סיכום כולל יוקרתי -->
    <footer class="footer container">
      <div class="summary">
        <span class="sum-label">סה"כ תלמידים בחטיבת הביניים:</span>
        <span id="totalCount" class="sum-number">—</span>
      </div>
      <nav class="small-links">
        <a href="admin.html" class="muted">מסך ניהול (למנהלים)</a>
        <span class="dots">·</span>
        <a href="about.html" class="muted">אודות</a>
      </nav>
    </footer>

  <!-- מודאל אימות מנהל -->
  <dialog id="adminDialog" class="dialog">
    <form method="dialog" class="dialog-card" id="adminForm">
      <h3>כניסת מנהל</h3>
      <p class="muted">הזן קוד מנהל כדי לערוך נתונים.</p>
      <label class="field">
        <span>קוד מנהל</span>
        <input id="adminCode" type="password" inputmode="numeric" autocomplete="off" placeholder="******" required />
      </label>
      <div class="dialog-actions">
        <button value="cancel" class="btn btn-ghost" type="button" id="cancelAdmin">בטל</button>
        <button class="btn" type="submit">אשר</button>
      </div>
      <p id="adminError" class="error" role="alert" hidden>קוד שגוי</p>
    </form>
  </dialog>

  <p id="last-updated" dir="rtl" style="font-size:.9rem;opacity:.8"></p>
  <script>
    fetch('./meta/progress.json').then(r=>r.json()).then(d=>{
      document.getElementById('last-updated').textContent =
        `עודכן לאחרונה: ${new Date(d.timestamp||Date.now()).toLocaleString('he-IL')}`;
    }).catch(()=>{});
      // שליפת סה"כ תלמידים
      fetch('./data/summary/counts.json').then(r=>r.json()).then(d=>{
        document.getElementById('totalCount').textContent = d.total || '—';
        document.getElementById('count7').textContent = d.byGrade?.['7'] ?? '—';
        document.getElementById('count8').textContent = d.byGrade?.['8'] ?? '—';
        document.getElementById('count9').textContent = d.byGrade?.['9'] ?? '—';
      }).catch(()=>{});
  </script>
  <script src="script.js" defer></script>
  <!-- HMR check: modified for live reload test -->
</body>
  <script>
  (function(){
    const isDev = location.hostname.endsWith("github.dev") || location.port === "5500";
    if ('serviceWorker' in navigator) {
      if (isDev) { navigator.serviceWorker.getRegistrations().then(rs=>rs.forEach(r=>r.unregister())); }
      else { window.addEventListener('load', ()=>navigator.serviceWorker.register('./service-worker.js').catch(console.error)); }
    }
  })();
  let deferredPrompt;
  const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
  const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    document.getElementById('installBtn')?.removeAttribute('disabled');
  });
  window.addEventListener('load', () => {
    const installBtn = document.getElementById('installBtn');
    const iosHint = document.getElementById('iosHint');
    if (isStandalone) {
      if (installBtn) { installBtn.textContent = 'מותקן ✔'; installBtn.disabled = true; }
      return;
    }
    if (isIOS) {
      if (iosHint) iosHint.hidden = false;
    }
    if (installBtn) {
      if (!deferredPrompt && !isIOS) installBtn.setAttribute('disabled','');
      installBtn.addEventListener('click', async () => {
        if (!deferredPrompt) return;
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        deferredPrompt = null;
        if (outcome === 'accepted') {
          installBtn.textContent = 'מותקן ✔';
          installBtn.disabled = true;
        }
      });
    }
  });
  </script>
</html>
